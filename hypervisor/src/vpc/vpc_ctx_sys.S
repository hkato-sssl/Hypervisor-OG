/*
 * vpc/vpc_ctx_sys.S
 *
 * (C) 2019 Hidekazu Kato
 *
 * CAUTION: Don't edit this file directry.
 *          This file is automatically generated.
 */

#include "lib/asm.h"
#include "hypervisor/vpc_register.h"

        .global         vpc_load_ctx_system_register
        .section        ".text.vpc_load_ctx_system_register", "ax", %progbits
        .type           vpc_load_ctx_system_register, %function
        .balign         4
        // x0 - the address of Register Array
vpc_load_ctx_system_register:
        add             x1, x0, #(VPC_CSSELR_EL1 * 8)

        ldp             x2, x3, [x1], #16
        msr             CSSELR_EL1, x2
        msr             ESR_EL1, x3
        ldp             x2, x3, [x1], #16
        msr             FAR_EL1, x2
        msr             VBAR_EL1, x3
        ldp             x2, x3, [x1], #16
        msr             SCTLR_EL1, x2
        msr             TTBR0_EL1, x3
        ldp             x2, x3, [x1], #16
        msr             TTBR1_EL1, x2
        msr             TCR_EL1, x3
        ldp             x2, x3, [x1], #16
        msr             MAIR_EL1, x2
        msr             CONTEXTIDR_EL1, x3
        ldp             x2, x3, [x1], #16
        msr             CPACR_EL1, x2
        msr             PAR_EL1, x3
        ldp             x2, x3, [x1], #16
        msr             TPIDR_EL0, x2
        msr             TPIDR_EL1, x3
        ldp             x2, x3, [x1], #16
        msr             TPIDRRO_EL0, x2
        msr             CNTKCTL_EL1, x3
        ldp             x2, x3, [x1], #16
        msr             CNTP_CTL_EL0, x2
        msr             CNTP_CVAL_EL0, x3
        ldp             x2, x3, [x1], #16
        msr             CNTV_CTL_EL0, x2
        msr             CNTV_CVAL_EL0, x3
        ldp             x2, x3, [x1], #16
        msr             VPIDR_EL2, x2
        msr             VMPIDR_EL2, x3
        ldp             x2, x3, [x1], #16
        msr             IFSR32_EL2, x2
        msr             ESR_EL2, x3
        ldp             x2, x3, [x1], #16
        msr             HPFAR_EL2, x2
        msr             VTTBR_EL2, x3
        ldp             x2, x3, [x1], #16
        msr             VTCR_EL2, x2
        msr             HCR_EL2, x3
        ldp             x2, x3, [x1], #16
        msr             HSTR_EL2, x2
        msr             HACR_EL2, x3
        ldp             x2, x3, [x1], #16
        msr             DACR32_EL2, x2
        msr             CNTVOFF_EL2, x3

        ret

        .global         vpc_store_ctx_store_system_register
        .section        ".text.vpc_store_ctx_store_system_register", "ax", %progbits
        .type           vpc_store_ctx_store_system_register, %function
        .balign         4
        // x0 - the address of Register Array
vpc_store_ctx_store_system_register:
        add             x1, x0, #(VPC_CSSELR_EL1 * 8)

        mrs             x2, CSSELR_EL1
        mrs             x3, ESR_EL1
        stp             x2, x3, [x1], #16
        mrs             x2, FAR_EL1
        mrs             x3, VBAR_EL1
        stp             x2, x3, [x1], #16
        mrs             x2, SCTLR_EL1
        mrs             x3, TTBR0_EL1
        stp             x2, x3, [x1], #16
        mrs             x2, TTBR1_EL1
        mrs             x3, TCR_EL1
        stp             x2, x3, [x1], #16
        mrs             x2, MAIR_EL1
        mrs             x3, CONTEXTIDR_EL1
        stp             x2, x3, [x1], #16
        mrs             x2, CPACR_EL1
        /* mrs             x3, PAR_EL1
         * PAR_EL1 is always sotred when the context has switched
         * from Guest to Hypervisor.
         */
        str             x2, [x1], #16
        mrs             x2, TPIDR_EL0
        mrs             x3, TPIDR_EL1
        stp             x2, x3, [x1], #16
        mrs             x2, TPIDRRO_EL0
        mrs             x3, CNTKCTL_EL1
        stp             x2, x3, [x1], #16
        mrs             x2, CNTP_CTL_EL0
        mrs             x3, CNTP_CVAL_EL0
        stp             x2, x3, [x1], #16
        mrs             x2, CNTV_CTL_EL0
        mrs             x3, CNTV_CVAL_EL0
        stp             x2, x3, [x1], #16
        mrs             x2, VPIDR_EL2
        mrs             x3, VMPIDR_EL2
        stp             x2, x3, [x1], #16
        mrs             x2, IFSR32_EL2
        mrs             x3, ESR_EL2
        stp             x2, x3, [x1], #16
        mrs             x2, HPFAR_EL2
        mrs             x3, VTTBR_EL2
        stp             x2, x3, [x1], #16
        mrs             x2, VTCR_EL2
        mrs             x3, HCR_EL2
        stp             x2, x3, [x1], #16
        mrs             x2, HSTR_EL2
        mrs             x3, HACR_EL2
        stp             x2, x3, [x1], #16
        mrs             x2, DACR32_EL2
        mrs             x3, CNTVOFF_EL2
        stp             x2, x3, [x1], #16

        ret

        .end
